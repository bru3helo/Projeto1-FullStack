<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <title>Document</title>
</head>
<body>
    <body>
        <div class="container">
          <h1>Monster Search</h1>
          <input type="text" id="monsterInput" placeholder="Enter a monster name"/>
          <p></p>
          <button id="searchButton">Search</button>
          <div id="searchResult" class="search-result"></div>
          <ul id="monsterResult"></ul>
        </div>
    </body>
    </html>
    <link rel="stylesheet" href="style.css" />
    <title>Document</title>
</head>
</html>
<script>
  const input = document.getElementById('monsterInput');
  const ul = document.querySelector('#monsterResult');
  const p = document.querySelector('p');
  //Seguinte, pra fazer a busca de monstros, eu fiz uma função que pega os monstros da API e coloca em um array, depois eu fiz uma função que faz a busca dos monstros no array e coloca em uma lista, e por fim, fiz uma função que pega o nome do monstro que o usuário digitou e faz a busca na API, e coloca o nome e o tipo do monstro em uma lista.
  let monsters = [];

  //To fazendo a chamada da API usando o fetch
  fetch("https://www.dnd5eapi.co/api/monsters")
    .then((res) => res.json())
    .then((data) => {
      //Com a promisse que me retornou, estou criando um novvo array com os nomes dos monstros
      monsters = data.results.map((monster) => monster.name);
      autoComplete(monsters);
    });

  //Essa é a função pica das galáxias que faz o autocomplete
  function autoComplete(monsters) {
    input.addEventListener("input", () => {
      // Pega o valor do input e coloca em minúsculo
      const inputValue = input.value.toLowerCase();

      // Limpa a lista de monstros
      while (ul.firstChild) {
        ul.removeChild(ul.firstChild);
      }

      // Se o input estiver vazio, não faz nada
      if (!inputValue) return;

      // Filtra os monstros que começam com o valor do input utilizando a função startsWith
      const autocomplete = monsters.filter((monster) =>
        monster.toLowerCase().startsWith(inputValue)
      );

      //completa a lista de monstros
      autocomplete.forEach((name) => {
        const li = document.createElement('li');
        li.textContent = name;
        ul.appendChild(li);
      });

      // Se a lista de monstros não estiver vazia, exibe a lista
      ul.style.display = 'block';


      // Limpa o resultado da busca anterior
      searchResult.innerHTML = "";
    });

    // Se o input perder o foco, esconde a lista, o perder foco é tipo quando clicka em outro canto da tela, ai meio que ele some sabe
    input.addEventListener('blur', () => {
      setTimeout(() => {
        ul.style.display = 'none';
      }, 200);
    });

    // Se clicar em um monstro da lista, coloca o nome do monstro no input e esconde a lista muito foda né
    ul.addEventListener('click', (event) => {
      if (event.target.tagName === 'LI') {
        input.value = event.target.textContent;
        ul.style.display = 'none';
      }
    });
  }

  //Aqui é oq vocês já tinham ai eu preservei
  const monsterInput = document.getElementById("monsterInput");
  const searchButton = document.getElementById("searchButton");
  const searchResult = document.getElementById("searchResult");

  //função normal
  searchButton.addEventListener("click", () => {
    const monsterName = monsterInput.value.toLowerCase();
    if (monsterName) {
      searchMonster(monsterName);
      input.value= ""
    } else {
      searchResult.innerHTML = "Por favor, insira o nome de um monstro.";
    }
  });

  function searchMonster(monsterName) {
    searchResult.innerHTML = "Procurando...";
    //Aqui eu tive que criar, por causa que tava enfretando problemas pra nome de monstro composto
    //Ai qq eu to fazendo, pegando o nome e dando um replace no espaço por um traço, por causa que a API recomenda esse uso
    const monsterNameComEspaco = monsterName.replace(/ /g, "-")
    fetch(`https://www.dnd5eapi.co/api/monsters/${monsterNameComEspaco}`)
      .then((res) => res.json())
      .then((data) => {
        if (data.error) {
          searchResult.innerHTML = "Monstro não encontrado.";
        } else {
          searchResult.innerHTML = "";
          const ul = document.createElement('ul');
          const nome = document.createElement('li');
          const tipo = document.createElement('li');
          //Aqui eu to pegando o nome e o tipo do monstro e colocando em uma lista, utilizando o spred operator
          nome.innerHTML = `Nome: ${data.name}`;
          tipo.innerHTML = `Tipo: ${data.type}`;
          ul.appendChild(nome);
          ul.appendChild(tipo);
          searchResult.appendChild(ul);
        }
      })
      //tratamento de erro
      .catch((error) => {
        searchResult.innerHTML = "Ocorreu um erro.";
      });
      //e fim
  }
</script>